<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="RESOURCE_SITE_URL/admin/themes/default/easyui.css">
        <link rel="stylesheet" type="text/css" href="RESOURCE_SITE_URL/admin/themes/icon.css">
        <link rel="stylesheet" type="text/css" href="RESOURCE_SITE_URL/admin/css/css.css">
        <script type="text/javascript" src="RESOURCE_SITE_URL/admin/js/jquery-1.8.0.min.js"></script>
        <script type="text/javascript" src="RESOURCE_SITE_URL/admin/js/jquery.easyui.min.js"></script>
        <!-- <script type="text/javascript" src="RESOURCE_SITE_URL/admin/js/formatter.js"></script> -->
        <script type="text/javascript" src="RESOURCE_SITE_URL/admin/js/functions.js"></script>
        <style>
            .easyui-validatebox {
                display: inline-block;
                margin:5px;
            }
        </style>
    </head>
    <body>
        <div class="ToolTip_Form" style="width:100%;">
            <form id="classForm" method="post">
                <table class="tooltable" style="width: 100%;">
                    <tr>
                        <td colspan="2" align="center" class="tooltd_mine">
                            <label>课程基本信息</label>    
                        </td>
                    </tr>
                    <tr>
                        <td class="tooltd_mine">
                            <label><font color="#FF0000">* </font>店铺名称</label>
                        </td>
                        <td class="tooltdgray_mine">
                            <select name="store_id" id="store_id">
                                <option value="0">请选择</option>
                                <foreach name="stores" item="vo" key="k">
                                    <option value="<{$vo.store_id}>" <if condition="$vo['store_id'] eq $classInfo['store_id']"> selected</if>><{$vo.store_name}></option>
                                </foreach>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="tooltd_mine">
                            <label><font color="#FF0000">* </font>课程讲师</label>
                        </td>
                        <td class="tooltdgray_mine">
                            <select id="teachers" name="teacher_id" style="width:118px;">
                                <foreach name="teachers" item="vo" key="k">
                                    <option value="<{$vo['teacher_id']}>" <if condition="$vo['teacher_id'] eq $classInfo['teacher_id']"> selected</if>><{$vo.teacher_name}></option>
                                </foreach>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="tooltd_mine">
                            <label><font color="#FF0000">* </font>课程名称</label>  
                        </td>
                        <td class="tooltdgray_mine"> 
                            <input class="easyui-validatebox required" message="请填写课程名称" type="text" id="class_title" style="width:20%;" name='class_title' value="<{$classInfo['class_title']}>">
                        </td>
                    </tr>
                    <tr>   
                        <td class="tooltd_mine">
                            <label><font color="#FF0000">* </font>课程主图</label>  
                        </td>
                        <td class="tooltdgray_mine">
                            <div class="div">
                                <p class="sc">
                                    <input type="hidden" name="class_image" value="<{$classInfo['class_image']}>">
                                    <input type="file" class="required" message="请上传课程主图" id="class_image"/>
                                </p>
                                <p class="tu"><img src="UPLOADS_SITE_URL/<{$Think.const.ATTACH_CLASS}>/<{$classInfo['class_image']}>" width="65" height="64" ></p>
                                <p class="zhu">注：图片大小750*430px</p>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="tooltd_mine"> 
                            <label><font color="#FF0000">*</font>课程价格</label>  
                        </td>
                        <td class="tooltdgray_mine"> 
                            <label style="display:inline-block;width: 70px">原价 :</label> 
                            <input class="easyui-validatebox required" message="请填写课程原价" type="text" id="class_price" style="width:15%;" name='class_price' value="<{$classInfo['class_price']}>"/>
                            <br/>

                            <foreach name="userLevel" item="vo" key="k">
                                <label style="display:inline-block;width: 70px"><{$vo}> :</label>
                                <input class="easyui-validatebox" type="text" style="width:15%;" name='userLevelPrice[<{$k}>]' value="<{$classUserPrice[$k]}>" />
                                <br/>
                            </foreach>
                        </td>
                    </tr>
                    <tr>
                        <td class="tooltd_mine">
                            <label><font color="#FF0000">*</font>课程排序</label>
                        </td>
                        <td class="tooltdgray_mine">
                            <label style="display:inline-block;width: 70px">排序 :</label>
                            <input class="easyui-validatebox required" message="请填写课程排序" type="text" id="class_sort" style="width:15%;" name='class_sort' value="<{$classInfo.class_sort}>"/>
                            <br/>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center" class="tooltd_mine">
                            <label>课程详情描述</label>    
                        </td>
                    </tr>
                    <tr>
                        <td class="tooltd_mine"> 
                            <label><font color="#FF0000">* </font>课程描述</label>  
                        </td>
                        <td class="tooltdgray_mine">
                            <textarea name="body" style="resize: none; width: 400px; height: 100px;"><{$classInfo['class_body']}></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center" class="tooltd_mine">
                            <label>分销信息</label>    
                        </td>
                    </tr>
                    <tr>
                        <td class="tooltd_mine"> 
                            <label>佣金比例</label>  
                        </td>
                        <td class="tooltdgray_mine"> 
                            <input class="easyui-validatebox" message="请填写佣金比例" type="text" id="commis_rate" style="width:5%;" name='commis_rate' value="<{$classInfo['commis_rate']}>"/> %
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center" class="tooltd_mine">
                            <label>微信分享信息</label>    
                        </td>
                    </tr>
                    <tr>
                        <td class="tooltd_mine"> 
                            <label><font color="#FF0000">*</font>分享标题</label>  
                        </td>
                        <td class="tooltdgray_mine"> 
                            <input class="easyui-validatebox required" message="请填写分享标题" type="text" id="fx_title" style="width:25%;" name='fx_title' value="<{$classInfo['fx_title']}>"/>
                        </td>
                    </tr>
                    <tr>
                        <td class="tooltd_mine"> 
                            <label><font color="#FF0000">*</font>分享描述</label>  
                        </td>
                        <td class="tooltdgray_mine"> 
                            <input class="easyui-validatebox required"  message="请填写分享描述" type="text" id="fx_desc" style="width:25%;" name='fx_desc' value="<{$classInfo['fx_desc']}>"/>
                        </td>
                    </tr>
                    <tr>   
                        <td class="tooltd_mine">
                            <label><font color="#FF0000">* </font>分享缩略图</label>  
                        </td>
                        <td class="tooltdgray_mine">
                            <div class="div">
                                <p class="sc">
                                    <input type="hidden" name="fx_img" value="<{$classInfo['fx_img']}>">
                                    <input type="file" class="required" message="请上传分享缩略图" id="fx_img"/>
                                </p>
                                <p class="tu"><img src="UPLOADS_SITE_URL/<{$Think.const.ATTACH_CLASS}>/<{$classInfo['fx_img']}>" width="65" height="64" ></p>
                                <p class="zhu">注：图片大小100*100</p>
                            </div>
                        </td>
                    </tr>
                </table>
                <div  align="right" style="margin-top:10px;float: left;margin-bottom: 10px;">
                    <input name="class_id" type="hidden" value="<{$classInfo['class_id']}>"/>
                    <a href="javascript:;" class="easyui-linkbutton" icon="icon-ok" id="saveBtn">提交</a>
                    <!-- <a href="javascript:;" class="easyui-linkbutton" icon="icon-redo" onclick="reset('#radioForm');">重置</a> -->
                    <a href="javascript:;" class="easyui-linkbutton" icon="icon-cancel" onclick="javascript:history.go(-1);">返回</a>
                </div>
            </form>
        </div>
        <script type="text/javascript">
            var url = '<{$Think.config.APP_SITE_URL}>/class/uploadImages';
            $(function () {
                //店铺选择讲师联动
                $( '#store_id' ).on('change',function () {
                    $('#teachers').empty();
                    var store_id = $(this).val();
                    $.ajax({
                        type : "POST",                                            // 使用post方法访问后台
                        dataType : "json",                                        // 返回json格式的数据
                        url: "/class/getTeachers",                                    // 要访问的后台地址
                        data : {
                            "store_id": store_id
                        },
                        complete : function() {},
                        success : function(result) {// result为返回的数据
//
                            if (result.code == 1){
                                $.each(result.data, function(i,v){
                                    $('#teachers').append('<option value="'+v.teacher_id+'">'+v.teacher_name+'</option>')
                                })

                            }
                        }

                    });
                });
                // 图片上传
                $('#class_image, #fx_img').on('change', function () {
                    file = $(this)[0].files;
                    formName = $(this).attr('id');
                    obj = $(this).parents().siblings('.tu');
                    uploads(file, 'POST', url, obj, formName);
                })
                //表单提交
                $('#saveBtn').on('click', function () {
                    var data = $('#classForm').serialize();
                    $.ajax({
                        type: "post",
                        url: "/class/edit",
                        data: data,
                        dataType: "json",
                        success: function (data, textStatus) {
                            if (data.code == 0) {
                                $.messager.alert('提示', data.msg, 'warning');
                            } else {
                                $.messager.alert('提示', '更新成功', 'info', function () {
                                    window.location.href = "/class/list";
                                });
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            $.messager.alert('提示', '数据更新失败,请重新提交或者寻求管理员帮助', 'error');
                        }
                    })
                });
            })
        </script>
    </body>
</html>